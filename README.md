**课程作业，更新中**

这是一个基于Python的计算器，包括单位转换和函数绘图等其他功能，使用tkinter和customtkinter库设计

设计稿是fig文件

&同时还是宠物热量和食物分配计算器，三击右上角猫儿可以进入，可以支持单种猫粮/冻干/罐头，或多种混合喂食策略在猫的不同阶段投喂量计算。

# **为你的猫儿健康出力～**

实现功能：
### 1. 科学计算器功能 (calculator\_page.py)

* **基本运算**：支持加 (+)、减 (-)、乘 (\*)、除 (/) 等基本算术运算。
* **高级运算**：

  * 幂运算 (x^2, x^3, xⁿ)
  * 阶乘 (x!)
  * 倒数 (1/x)
  * 开方 (sqrt, y√x)
  * 求和 (Σ)
  * 积分 (∫)
  * 导数 (d/dx)
* **三角函数**：

  * 正弦 (sin)、余弦 (cos)、正切 (tan)
  * 反正弦 (sin⁻¹)、反余弦 (cos⁻¹)、反正切 (tan⁻¹)
* **对数与指数**：

  * 自然对数 (ln)
  * 常用对数 (log10)
  * 指数函数 (e^x)
  * 10的幂 (\*10^x)
* **角度/弧度模式**：

  * 支持角度 (DEG) 和弧度 (RAD) 模式切换，影响三角函数的计算。
* **表达式求值**：

  * 使用 `SafeEvaluator` 安全解析和计算数学表达式。
  * 支持隐式乘法（如 2x 被解析为 2\*x）。
  * 支持变量（如 x）和常量（如 π, e, Ans）。
* **历史记录**：

  * 保存计算历史，允许用户查看、复用或删除历史记录。
* **界面交互**：

  * 提供数字和操作符按钮，支持键盘输入。
  * 光标控制：通过界面按钮实现光标左右移动。
  * 清除 (AC) 和删除 (DEL) 功能。
  * 支持 Ans 键，引用上一次计算结果。
* **桌宠交互**：

  * 点击桌宠 (PetWidget) 可触发气泡提示，连续点击三次打开猫咪热量计算器。
* **声音效果**：

  * 按钮点击和桌宠交互时可播放音效（如 cat.mp3），支持静音切换。

### 2. 单位转换功能 (convert\_plot\_page.py)

* **长度转换**：

  * 支持单位：公里 (km)、米 (m)、厘米 (cm)、毫米 (mm)、英里 (mi)、码 (yd)、英尺 (ft)、英寸 (in)。
  * 通过 `UnitConverter` 类实现，基于相对米的转换因子。
* **质量转换**：

  * 支持单位：吨 (t)、千克 (kg)、克 (g)、磅 (lb)、盎司 (oz)。
  * 同样基于相对千克的转换因子。
* **温度转换**：

  * 支持单位：摄氏度 (C)、华氏度 (F)、开氏度 (K)。
  * 支持从一种温度单位到另一种的转换（如 C 到 F）。
* **界面交互**：

  * 提供下拉菜单选择单位类别（长度、质量、温度）和具体单位。
  * 支持单位对换 (Swap) 功能。
  * 输入值并点击“Convert”按钮或按回车键执行转换。
  * 显示转换结果或错误信息。

### 3. 函数绘图功能 (convert\_plot\_page.py)

* **函数绘制**：

  * 支持绘制一元函数 f(x)，如 sin(x)、x^2 等。
  * 用户可输入数学表达式，指定 x 轴范围 (x min, x max)。
  * 使用 `SafeEvaluator` 解析表达式，支持变量 x 和数学函数（如 sin、cos、sqrt 等）。
* **绘图控制**：

  * 自动生成采样点（400-1200 个），根据画布宽度动态调整。
  * 支持缩放（Zoom In/Out）和滚动条（x/y 轴）调整视图。
  * 显示坐标轴、刻度线和网格，支持动态调整刻度间隔。
  * 绘制平滑曲线，处理无效点（如非数值或无穷大）。
* **点值评估**：

  * 用户可输入 x 值，计算并显示对应 f(x) 值。
  * 在图上标记查询点，显示其坐标。
* **状态显示**：

  * 显示绘图状态（如表达式、模式、错误点数）。

### 4. 猫咪热量计算器 (pet\_calculator\_page.py)

* **热量需求计算**：

  * 根据猫咪体重 (kg) 和生长阶段计算基础代谢率 (RER) 和日能量需求 (DER)。
  * RER 计算公式：RER = 70 \* (weight)^0.75。
  * DER = RER \* 需求因子，需求因子根据猫咪状态（如发育期、已结扎等）从预定义范围选择。
* **支持的猫咪状态**：

  * 发育期、未结扎、已结扎、过胖、过瘦、11岁以上高龄。
  * 每种状态对应不同的 DER 系数范围。
* **食物热量数据库**：

  * 包含猫粮、罐头、冻干等多种食物类型的热量数据（kcal/100g）。
  * 支持品牌和具体产品选择（如 Firstmate、麻利等）。
  * 支持自定义热量输入。
* **混合喂食**：

  * 允许用户配置多种食物的比例，计算总热量和建议喂食量。
* **界面交互**：

  * 输入体重、选择阶段、调整 DER 系数（通过滑块或输入框）。
  * 显示 RER、DER 和每日建议喂食量（克数和总热量）。
  * 提供“如何判断猫咪状态”帮助图片 (howtojudge.jpeg)。
* **动画与交互**：

  * 桌宠 (PetWidget) 支持点击交互，播放猫叫音效 (maodie\_haqi.mp3) 或触发愤怒动画 (maodie\_haqi.gif)。
  * 愤怒模式：多次点击触发全屏 GIF 动画，持续一定时间。
  * 背景音乐：支持播放背景音乐 (JiMi\_Canon\_in\_Dmajor.mp3)，可静音。

### 5. 桌宠交互 (pet\_widget.py)

* **静态图片与 GIF 动画**：

  * 显示静态图片或 GIF 动画（如 pet.jpg、maodie\_changtai.jpg）。
  * 支持动态调整图片大小。
* **交互效果**：

  * 鼠标悬停时触发轻微抖动效果。
  * 点击时播放音效（如 cat.mp3）并触发缩放动画。
  * 三次点击触发特定动作（如打开猫咪热量计算器）。
* **禁用/启用**：

  * 支持启用或禁用交互状态。

### 6. 气泡提示 (dialogs.py)

* **动态气泡窗口**：

  * 在桌宠或其他控件附近显示带箭头的圆角气泡提示。
  * 支持方向（左、右、上、下）和自动消失（默认 2400ms）。
* **跨平台透明效果**：

  * macOS：使用每像素透明 (systemTransparent)。
  * Windows：使用色键透明或整体 alpha 透明。
* **自定义样式**：

  * 基于主题配色，调整气泡背景、文本和边框颜色。

### 7. 声音效果 (sound\_player.py)

* **音效播放**：

  * 支持播放按钮点击音效 (cat.mp3)、错误音效 (xp\_wrong.mp3) 和猫叫 (maodie\_haqi.mp3)。
  * 使用 pygame 实现，带音效缓存（最多 32 个）。
* **背景音乐**：

  * 支持播放循环背景音乐 (JiMi\_Canon\_in\_Dmajor.mp3)，可调整音量和起始位置。
  * 支持淡出停止 (fadeout)。
* **静音控制**：

  * 全局静音开关，保存最近音量设置，切换时自动恢复。

### 8. 主题与配色 (theme.py)

* **支持两种主题**：

  * iOS Light：明亮风格，白色背景，深色文本。
  * iOS Dark：暗黑风格，黑色背景，白色文本。
* **配色方案**：

  * 定义背景、按钮、文本、边框等颜色。
  * 应用于按钮、画布、气泡等界面元素。
* **自适应系统主题**：

  * 支持运行时通过system自适应系统主题，更新界面颜色。

### 9. 安全表达式解析 (safe\_eval.py)

* **安全求值**：

  * 使用 `ast` 模块解析表达式，限制允许的操作符和函数。
  * 支持的函数：sqrt, pow, log, log10, ln, exp, abs, sin, cos, tan, arcsin, arccos, arctan, root, factorial 等。
  * 支持常量：π (pi), e, Ans（上一次结果）。
* **隐式乘法**：

  * 自动插入乘法符号（如 2x -> 2\*x）。
* **角度/弧度支持**：

  * 三角函数根据模式（DEG/RAD）调整输入输出。
* **错误处理**：

  * 捕获无效表达式、未定义变量等错误，返回友好提示。

### 10. 其他辅助功能

* **跨平台兼容性**：

  * 适配 macOS 和 Windows 的透明效果和界面渲染。
* **响应式布局**：

  * 猫咪热量计算器支持动态布局调整（宽屏/单列切换，基于 920px 断点）。
* **错误提示**：

  * 使用 Windows XP 风格错误音效 (xp\_wrong.mp3) 提示无效输入。
